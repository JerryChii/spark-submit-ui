@main("Neptune Spark-sql"){
<script src="@routes.Assets.at("javascripts/underscore-min.js")" type="text/javascript"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" media="screen" href='@routes.Assets.at("stylesheets/bootstrap.min.css")'>
<script src="@routes.Assets.at("javascripts/jquery-1.11.1.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/bootstrap.min.js")" type="text/javascript" ></script>
<script type="text/javascript" src="http://cdn.hcharts.cn/highcharts/exporting.js"></script>
<script type="text/javascript" src="http://cdn.hcharts.cn/highcharts/export-excel.js"></script>
<script src="http://cdn.hcharts.cn/highcharts/highcharts.js"></script>
	<div class="tab-content">
		<div class="tab-pane active" id="horizontal-form">
			<div class="form-group">
				<label for="sql" class="col-sm-2 control-label">请输入要执行的SQL</label>
				<div class="col-sm-8">
					<textarea id="sql" cols="50" rows="4" class="form-control1"></textarea>
				</div>
			</div>
		</div>
	</div>
<div class="col-sm-8">
<button class="btn btn-primary" id="submit">提交</button>
	<div id="result"></div>
</div>
<div class="col-sm-8 col-sm-offset-2">
	<a class="btn-success btn" href="@routes.SparkSql.download">导出文件</a>
</div>
<script>
		function resultToTable(data) {
			var header = data.header;
			var sql_data = data.data;
			var result = "";
			var tr = "";
			for (var i = 0;i < header.length;i++) {
				tr += "<th>" + header[i] + "</th>";
			}
			result += "<tr>" + tr + "</tr>";

			for (var j = 0;j < sql_data.length;j++) {
				tr = "";
				for (var i = 0;i < sql_data[j].length;i++) {
					tr += "<td>" + sql_data[j][i] + "</td>";
				}
				result += "<tr>" + tr + "</tr>";
			}

			return "<table class='table table-bordered table-striped'>" + result + "</table>";
		}

		function resultToChart(data) {
			var header = data.header;
			var select = "";
			for (var i = 0;i < header.length;i++) {
				select += "<option value='" + header[i] + "'>" + header[i] + "</option>";
			}
//			select = "<select class='form-control'>" + select + "</select>";

			var result
					= "<div class='form-group'>"
					+ "<label class='col-sm-4 control-label' for='x'>x坐标：</label>"
					+ "<div class='col-sm-4'><select class='form-control' id='x'>" + select + "</select></div>"
					+ "</div>"
					+ "<div class='form-group'>"
					+ "<label class='col-sm-4 control-label' for='y'>y坐标：</label>"
					+ "<div class='col-sm-4'><select class='form-control' id='y'>" + select + "</select></div>"
					+ "</div>";

			result += "<div class='form-group'><div class='col-sm-4'></div><button class='btn btn-default' id='generate'>生成</button></div>";
			result = "<div class='form-horizontal'>" + result + "</div>"
			result += "<div id='chartDiv'></div>";

			return result;
		}

		function toggleToChart(div, data) {
			$(div).find("#generate").click(function() {
				var header = data.header;
				var sql_data = data.data;
				var categories = [];
				var value = [];
				var x_index = header.indexOf($(div).find("#x").val());
				var y_index = header.indexOf($(div).find("#y").val());

				for (var j = 0;j < sql_data.length;j++) {
					categories.push(sql_data[j][x_index]);
					value.push(sql_data[j][y_index]);
				}

				$(div).find("#chartDiv").highcharts({
					chart: {
						type: 'column'
					},
					xAxis: {
						categories: categories
					},
					yAxis: {
						min: 0,
						title: {
							text: $(div).find("#y").val()
						}
					},
					plotOptions: {
						column: {
							pointPadding: 0.2,
							borderWidth: 0
						}
					},
					series: [{
						name: $(div).find("#y").val(),
						data: value
					}]
				});
			})
		}

		function resultToDisplay(data) {
			$("#result").html("");

			var result = "";
			result += '<li role="presentation" class="active"><a href="#table" aria-controls="table" role="tab" data-toggle="tab">表格</a></li>';
			result += '<li role="presentation"><a href="#chart" aria-controls="chart" role="tab" data-toggle="tab">图表</a></li>';
			result = "<ul class='nav nav-tabs' role='tablist'>" + result + "</ul>";

			result += '<div class="tab-content">'
					+ '<div role="tabpanel" class="tab-pane active" id="table">' + resultToTable(data) + '</div>'
					+ '<div role="tabpanel" class="tab-pane" id="chart">' + resultToChart(data) + '</div>'
					+ "</div>";

			$("#result").html(result);

			toggleToChart($("#chart"), data);
		}

		$(document).ready(function(){
			$("#submit").click(function(){
				$.ajax({
					"data": {
						"sql": $("#sql").val()
					},
					"method": "POST",
					"url": "/executesql",
					"dataType": "json",
					"success": function (data, textStatus, jqXHR){
						resultToDisplay(data);
					}
				});
			})
		})
	</script>

}
@copyright()






