@main("Neptun Dashboard") {
    <script src="@routes.Assets.at("javascripts/globalize.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/dx.chartjs.js")" type="text/javascript"></script>
    <script charset="utf-8">
            $(document).ready(function(){
                $.ajax({
                    type:"GET",
                    url:"/yarnInfo",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var app=myobj.apps.app;
                        for(var i=0;i<app.length;i++){
                            var finalStatus = app[i].finalStatus;
                            if (finalStatus == 'SUCCEEDED'){
                                //console.log(app[i]);
                                var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                                $('#yarn_table tbody').append(str);
                            }
                        }
                    }
                });
                show_work();
                task_count();
                cluster_info();
            });
            //work list准实时展示
            function show_work(){
                $('#work_table tbody').html("");
                $.ajax({
                    type:"GET",
                    url:"/workerlist",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var url = myobj.url;
                        var status = myobj.status;
                        var workers=myobj.workers;
                        for(var i=0;i<workers.length;i++){
                            var str = "<tr class='info'><td>"+workers[i].id+"</a></td><td>"+workers[i].host+"</td><td>"+workers[i].cores+"</td><td>"+workers[i].coresused+"</td><td>"+workers[i].memory+"</td><td>"+workers[i].memoryused+"</td><td>"+workers[i].state+"</td><td>"+new Date(workers[i].lastheartbeat).toLocaleString()+"</td><tr>"
                            $('#work_table tbody').append(str);
                        }
                    }
                });
            }
            //setInterval(show_work,5000);
            //计算任务个数
            function task_count(){
                $.ajax({
                    type:"GET",
                    url:"/yarnInfo",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var app=myobj.apps.app;
                        var succ_task = 0;
                        var run_task = 0;
                        var fail_task = 0;
                        var plain_task =0;
                        for(var i=0;i<app.length;i++){
                            var finalStatus = app[i].finalStatus;
                            var state = app[i].state
                            //计算完成的
                            if(finalStatus == 'SUCCEEDED'){
                                succ_task += 1;
                            }
                            if(state == 'RUNNING'){
                                run_task += 1;
                            }
                            if(finalStatus == 'FAILED'){
                                fail_task += 1;
                            }
                            if(state == 'ACCEPTED'){
                                plain_task += 1;
                            }
                        }
                        $('#run').html(run_task);
                        $('#succ').html(succ_task);
                        $('#fail').html(fail_task);
                        $('#plain').html(plain_task);
                    }
                });

            }
    </script>
    <script>

            //spark集群运行情况
            function cluster_info(){
                $.ajax({
                    type:"GET",
                    url:"/spark_info",
                    dataType:"json",
                    success:function(data){
                        var sparkinfo = eval(data);
                        var alive_worker = sparkinfo.alive_workers;
                        var alive_workers = alive_worker +" "+"Workers"
                        var cores = sparkinfo.cores;
                        var memory = sparkinfo.memory;
                        //var applications = sparkinfo.applications;
                        var drivers = sparkinfo.drivers;
                        //var status = sparkinfo.status;

                        var total_c = cores.split(",")[0];
                        var used_c = cores.split(",")[1].replace(" Used","");

                        var total_m = memory.split(",")[0];
                        var used_m = memory.split(",")[1].replace(" GB Used","");

                        var driver_run = drivers.split(",")[0].replace(" Running","");
                        var driver_all = drivers.split(",")[1];

                        $('#alive_workers').html(alive_workers.replace(" Workers",""));

                        $('#total_c').html(total_c);
                        $('#used_c').html(used_c);

                        $('#total_m').html(total_m);
                        $('#used_m').html(used_m);

                        //$('#applications').html(applications);

                        $('#driver_run').html(driver_run);
                        $('#driver_all').html(driver_all);

                        //$('#status').html(status);


                    }
                });

            }


    </script>
    <div class="row">

        <div class="col-sm-3">

            <div class="xe-widget xe-counter">
                <div class="xe-icon">
                    <i class="fa fa-train fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="run">0</strong>
                    <span>运行中</span>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter xe-counter-blue">
                <div class="xe-icon">
                    <i class="fa fa-check fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="succ">0</strong>
                    <span>成功执行</span>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter xe-counter-info">
                <div class="xe-icon">
                    <i class="fa-times fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="fail">0</strong>
                    <span>失败</span>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter xe-counter-red">
                <div class="xe-icon">
                    <i class="fa fa-plane fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="plain">0</strong>
                    <span>计划任务</span>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter-block" >
                <div class="xe-upper">

                    <div class="xe-icon">
                        <i class="fa fa-heartbeat fa-2x"></i>
                    </div>
                    <div class="xe-label">
                        <strong class="num" id="alive_workers"></strong>
                        <span>Alive Worker</span>
                    </div>

                </div>
                <div class="xe-lower">
                    <div class="border"></div>

                    <span>Total Nodes</span>
                    <strong>9 Total</strong>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter-block xe-counter-block-purple" >
                <div class="xe-upper">

                    <div class="xe-icon">
                        <i class="fa fa-puzzle-piece fa-2x"></i>
                    </div>
                    <div class="xe-label">
                        <strong class="num" id="used_c">0</strong>
                        <span>Used Cores</span>
                    </div>

                </div>
                <div class="xe-lower">
                    <div class="border"></div>

                    <span>Total Cores</span>
                    <strong id="total_c">0</strong>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter-block xe-counter-block-red" >
                <div class="xe-upper">

                    <div class="xe-icon">
                        <i class="fa fa-building fa-2x"></i>
                    </div>
                    <div class="xe-label">
                        <strong class="num" id="used_m">0</strong>
                        <span>Spark Mem</span>
                    </div>

                </div>
                <div class="xe-lower">
                    <div class="border"></div>

                    <span>Total Mem</span>
                    <strong id="total_m">0</strong>
                </div>
            </div>

        </div>

        <div class="col-sm-3">

            <div class="xe-widget xe-counter-block xe-counter-block-pink" >
                <div class="xe-upper">

                    <div class="xe-icon">
                        <i class="fa fa-info fa-2x"></i>
                    </div>
                    <div class="xe-label">
                        <strong class="num" id="driver_run">0</strong>
                        <span>Drivers Info</span>
                    </div>

                </div>
                <div class="xe-lower">
                    <div class="border"></div>

                    <span>Total Mem</span>
                    <strong id="driver_all">0</strong>
                </div>
            </div>

        </div>

        <div class="clearfix"></div>

        <div class="panel panel-body">

            <div class="row">
                <div class="col-sm-6">
                    <script type="text/javascript">
                            jQuery(document).ready(function($)
                            {
                                var gauge = $('#gauge-3').dxCircularGauge({
                                    scale: {
                                        startValue: 0,
                                        endValue: 100,
                                        majorTick: {
                                            tickInterval: 10
                                        },
                                        label: {
                                            customizeText: function (arg) {
                                                return arg.valueText + ' %';
                                            }
                                        }
                                    },
                                    rangeContainer: {
                                        ranges: [
                                            { startValue: 0, endValue: 40, color: '#90ee7e' },
                                            { startValue: 40, endValue: 80, color: '#FF7F24' },
                                            { startValue: 80, endValue: 100, color: '#f45b5b' }
                                        ]
                                    },
                                    title: {
                                        text: '本组资源',
                                        font: { size: 20}
                                        },
                                        tooltip: {
                                            enabled: true,
                                            format: {
                                                type: 'present',
                                                precision: 2
                                            }
                                    },
                                    value: 35
                                }).dxCircularGauge('instance');

                                $('#chart_container').highcharts({
                                    chart: {
                                        plotBackgroundColor: null,
                                        plotBorderWidth: null,
                                        plotShadow: false
                                    },
                                    title: {
                                        text: '集群功能划分'
                                    },
                                    tooltip: {
                                        pointFormat: '{series.name}'
                                    },
                                    plotOptions: {
                                        pie: {
                                            allowPointSelect: true,
                                            cursor: 'pointer',
                                            dataLabels: {
                                                enabled: true,
                                                color: '#000000'
                                            },
                                            showInLegend: true
                                        }
                                    },
                                    series: [{
                                        type: 'pie',
                                        name: '集群节点数',
                                        data: [
                                            ['Spark',6],
                                            ['Hadoop',5],
                                            ['Hbase',3],
                                            ['Hive',1],
                                            ['Mysql',1]
                                        ]
                                    }]
                                });


                                var doughnut2_data_source = [
                                    { id: 0, x1: 0 },
                                    { id: 1, x1: 2 },
                                    { id: 2, x1: 3 },
                                    { id: 3, x1: 5 },
                                    { id: 4, x1: 7 },
                                    { id: 5, x1: 3 },
                                    { id: 6, x1: 1 },
                                    { id: 7, x1: 2 },
                                    { id: 8, x1: 5 },
                                    { id: 9, x1: 4 },
                                ];

                                $("#area-2").dxChart({
                                    dataSource: doughnut2_data_source,
                                    commonSeriesSettings: {
                                        type: "area",
                                        argumentField: "id"
                                    },
                                    series: [
                                        { valueField: "x1", name: "15-64 years", color: '#7c38bc', opacity: .7 },
                                    ],
                                    argumentAxis:{
                                        valueMarginsEnabled: false
                                    },
                                    valueAxis:{
                                        label: {
                                            format: "millions"
                                        }
                                    },
                                    legend: {
                                        verticalAlignment: "bottom",
                                        horizontalAlignment: "center"
                                    },
                                    legend: {
                                        visible: false
                                    },
                                    commonAxisSettings: {
                                        label: {
                                            visible: false
                                        },
                                        grid: {
                                            visible: false
                                        }
                                    },
                                    margin: {
                                        bottom: 0,
                                        top: 30
                                    }
                                });


                            });
                    </script>

                    <div id="gauge-3" style="height: 440px; margin: 0 30px;"></div>

                </div>
                <div class="col-sm-6">

                    <div id="chart_container" style="height: 440px; margin: 0 30px;"></div>
                </div>


            </div>


        </div>

        <div class="row">
            <div class="col-sm-12">

                <div class="chart-item-bg-2">
                    <div class="chart-item-num num-sm" style="width: 370px;" data-count="this" data-from="0" data-to="85.89" data-decimal="," data-suffix="%" data-duration="3">0%</div>
                    <div class="chart-item-env no-padding">
                        <div id="area-2" style="height: 150px; margin: 0"></div>
                    </div>
                </div>
            </div>
        </div>


        </div>



   @* <script>

                $(document).ready(function () {
                    var data=[
                        {role:"Spark",
                            nums:6
                        },
                        {role:"Hadoop",
                            nums:5
                        },
                        {role:"Hbase",
                            nums:3
                        },
                        {role:"Hive",
                            nums:1
                        },
                        {roles:"Mysql",
                            num:1
                        }
                    ];

                    $("#chart_container").dxPieChart({
                        dataSource: data,
                        series: [
                            {
                                argumentField: "role",
                                valueField: "nums",
                                label: {
                                    visible: true,
                                    connector: {
                                        visible: true,
                                        width: 1,
                                        verticalAlignment:"bottom"
                                    },
                                }
                            }
                        ],
                        title: "Area of Countries",
                        onPointClick: function (e) {
                            var point = e.target;

                            toggleVisibility(point);
                        },
                        onLegendClick: function (e) {
                            var arg = e.target;

                            toggleVisibility(this.getAllSeries()[0].getPointsByArg(arg)[0]);
                        }
                    });

                    function toggleVisibility(item) {
                        item.isVisible() ? item.hide() : item.show();
                    }


                    });
    </script>*@


        <div class="clearfix"></div>

    @copyright()

}