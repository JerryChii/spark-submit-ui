@main("Neptun Dashboard"){
<style type='text/css'>
    #worklist{
    width:100%;
    background-color:rgb(100%,100%,90%);
    }
    #date{
    width:50%;
    }
    #sparkinfo{
    width:50%;
    line-height:1.2;
    }
    .col-md-6 {
    width: 50%;
    height: 20%;
    }

    .col_1_of_2.span_1_of_2 {
    padding: 2px;
    }
</style>
<!----Calender -------->
<link rel="stylesheet" href="@routes.Assets.at("stylesheets/clndr.css")" type="text/css" />
<script src="@routes.Assets.at("javascripts/underscore-min.js")" type="text/javascript"></script>
            <script src="@routes.Assets.at("javascripts/moment-2.2.1.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/clndr.js")" type="text/javascript"></script>
            <script src="@routes.Assets.at("javascripts/site.js")" type="text/javascript"></script>
<!----End Calender -------->
    <div class="graphs">
        <div class="col_3">
            <div class="col-md-3 widget widget1">
                <div class="r3_counter_box"><i class="pull-left fa fa-train fa-2x running icon-rounded"></i>
                  <div class="stats">
                    <h5><strong><font color="#17d9d7" id='run'>0</font></strong></h5>
                      <span>运行中</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 widget widget1">
                <div class="r3_counter_box"><i class="pull-left fa fa-check fa-2x complate icon-rounded"></i>
                  <div class="stats">
                    <h5><strong><font color="#11ce76" id='succ'>0</font></strong></h5>
                      <span>成功执行</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 widget widget1">
                <div class="r3_counter_box">
                    <i class="pull-left fa fa-times fa-2x failed icon-rounded"></i>
                    <div class="stats">
                      <h5><strong><font color="#ec0d11" id='fail'>0</font></strong></h5>
                      <span>失败</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3 widget">
                <div class="r3_counter_box">
                    <i class="pull-left fa fa-plane fa-2x cordinate icon-rounded"></i>
                    <div class="stats">
                      <h5><strong><font color="#00aced" id='plain'>0</font></strong></h5>
                      <span>计划任务</span>
                    </div>
                </div>
             </div>
            <div class="clearfix"> </div>
      </div>
      <div class="col_1">
            <div id="date" class="col-md-4 span_7" >
              <div class="cal1 cal_2"><div class="clndr"><div class="clndr-controls"><div class="clndr-control-button"><p class="clndr-previous-button">previous</p></div><div class="month">July 2015</div><div class="clndr-control-button rightalign"><p class="clndr-next-button">next</p></div></div><table class="clndr-table" border="0" cellspacing="0" cellpadding="0"><thead><tr class="header-days"><td class="header-day">S</td><td class="header-day">M</td><td class="header-day">T</td><td class="header-day">W</td><td class="header-day">T</td><td class="header-day">F</td><td class="header-day">S</td></tr></thead><tbody><tr><td class="day adjacent-month last-month calendar-day-2015-06-28"><div class="day-contents">28</div></td><td class="day adjacent-month last-month calendar-day-2015-06-29"><div class="day-contents">29</div></td><td class="day adjacent-month last-month calendar-day-2015-06-30"><div class="day-contents">30</div></td><td class="day calendar-day-2015-07-01"><div class="day-contents">1</div></td><td class="day calendar-day-2015-07-02"><div class="day-contents">2</div></td><td class="day calendar-day-2015-07-03"><div class="day-contents">3</div></td><td class="day calendar-day-2015-07-04"><div class="day-contents">4</div></td></tr><tr><td class="day calendar-day-2015-07-05"><div class="day-contents">5</div></td><td class="day calendar-day-2015-07-06"><div class="day-contents">6</div></td><td class="day calendar-day-2015-07-07"><div class="day-contents">7</div></td><td class="day calendar-day-2015-07-08"><div class="day-contents">8</div></td><td class="day calendar-day-2015-07-09"><div class="day-contents">9</div></td><td class="day calendar-day-2015-07-10"><div class="day-contents">10</div></td><td class="day calendar-day-2015-07-11"><div class="day-contents">11</div></td></tr><tr><td class="day calendar-day-2015-07-12"><div class="day-contents">12</div></td><td class="day calendar-day-2015-07-13"><div class="day-contents">13</div></td><td class="day calendar-day-2015-07-14"><div class="day-contents">14</div></td><td class="day calendar-day-2015-07-15"><div class="day-contents">15</div></td><td class="day calendar-day-2015-07-16"><div class="day-contents">16</div></td><td class="day calendar-day-2015-07-17"><div class="day-contents">17</div></td><td class="day calendar-day-2015-07-18"><div class="day-contents">18</div></td></tr><tr><td class="day calendar-day-2015-07-19"><div class="day-contents">19</div></td><td class="day calendar-day-2015-07-20"><div class="day-contents">20</div></td><td class="day calendar-day-2015-07-21"><div class="day-contents">21</div></td><td class="day calendar-day-2015-07-22"><div class="day-contents">22</div></td><td class="day calendar-day-2015-07-23"><div class="day-contents">23</div></td><td class="day calendar-day-2015-07-24"><div class="day-contents">24</div></td><td class="day calendar-day-2015-07-25"><div class="day-contents">25</div></td></tr><tr><td class="day calendar-day-2015-07-26"><div class="day-contents">26</div></td><td class="day calendar-day-2015-07-27"><div class="day-contents">27</div></td><td class="day calendar-day-2015-07-28"><div class="day-contents">28</div></td><td class="day calendar-day-2015-07-29"><div class="day-contents">29</div></td><td class="day calendar-day-2015-07-30"><div class="day-contents">30</div></td><td class="day calendar-day-2015-07-31"><div class="day-contents">31</div></td><td class="day adjacent-month next-month calendar-day-2015-08-01"><div class="day-contents">1</div></td></tr></tbody></table></div></div>
            </div>
          <div id="sparkinfo"  class="col-md-4 span_4">
              <div   class="col_2">
                  <div class="box_1">
                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                          <a class="tiles_info">
                              <div class="tiles-head tw1">
                                  <div class="text-center">Worker节点数</div>
                              </div>
                              <div class="tiles-body tw2" >
                                      <h2 id="alive_workers"></h2>
                              </div>
                          </a>
                      </div>
                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                          <a class="tiles_info">
                              <div class="tiles-head tw1">
                                  <div class="text-center">Cores使用情况</div>
                              </div>
                              <div class="tiles-body tw2" >
                                  <h2 id="cores"></h2>
                              </div>
                          </a>
                      </div>

                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                          <a class="tiles_info tiles_blue">
                              <div class="tiles-head tiles_blue1">
                                  <div class="text-center">Spark内存使用情况</div>
                              </div>
                              <div class="tiles-body blue1" >
                                  <h3 id="memory"></h3>
                              </div>
                          </a>
                      </div>
                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                              <a class="tiles_info tiles_blue">
                                  <div class="tiles-head tiles_blue1">
                                      <div class="text-center">应用程序运行情况</div>
                                  </div>
                                  <div class="tiles-body blue1" >
                                  <h3 id="applications"></h3>
                                  </div>
                              </a>
                      </div>
                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                          <a class="tiles_info">
                              <div class="tiles-head fb1">
                                  <div class="text-center">Drivers运行情况</div>
                              </div>
                              <div class="tiles-body fb2" >
                              <h3 id="drivers"></h3>
                              </div>
                          </a>
                      </div>
                      <div class="col-md-6 col_1_of_2 span_1_of_2">
                          <a class="tiles_info tiles_blue">
                              <div class="tiles-head fb1">
                                  <div class="text-center">HA Master状态</div>
                              </div>
                              <div class="tiles-body fb1" id="status">
                              </div>
                          </a>
                      </div>
                      <div class="clearfix"> </div>
                  </div>
              </div>
          </div>
          <div class="clearfix"></div>

      </div>
        <div class="span_11">

            <div id = 'worklist' class="col-md-4 stats-info">
                <div class="panel-heading">
                    <h1 class="panel-title"><b>Workers List</b></h1>
                </div>
                <div class="panel-body">
                    spark://h136159.mars.grid.sina.com.cn:8080
                        <div class="text-success pull-right">Alive</div>
                    <table id='work_table'  class="table table-striped">
                        <thead>
                        <tr class="success">
                            <th>id</th>
                            <th>host</th>
                            <th>cores</th>
                            <th>coresused</th>
                            <th>memory</th>
                            <th>memoryused</th>
                            <th>state</th>
                            <th>lastheartbeat</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"> </div>
        </div>
        <div class="content_bottom">
            <div class="col-md-4 stats-info">
                <div class="panel-heading">
                    <h4 class="panel-title"><b>任务状态：</b></h4>
                </div>
                <div class="panel-body">
                    <ul>
                        <li><a href='javascript:void(0)' onclick='show_task(this)'>已完成的任务</a><div class="text-success pull-right"></div></li>
                        <li><a href='javascript:void(0)' onclick='show_task(this)'>运行中的任务</a><div class="text-success pull-right"></div></li>
                        <li><a href='javascript:void(0)' onclick='show_task(this)'>已失败任务</a><div class="text-success pull-right"></div></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-8 span_3">
                <div  class="bs-example1">
                    <table id='yarn_table' class="table table-striped">
                        <thead>
                        <tr>
                            <th>JobID</th>
                            <th>User</th>
                            <th>Queue</th>
                            <th>State</th>
                            <th>Progress</th>
                            <th>start</th>
                            <th>end</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="clearfix"> </div>
        </div>
        </div>
        @copyright()
        </div>
      <script charset="utf-8">
        $(document).ready(function(){
            $.ajax({
                type:"GET",
                url:"/yarnInfo",
                dataType:"json",
                success:function(data){
                  var myobj=eval(data);
                  var app=myobj.apps.app;
                  for(var i=0;i<app.length;i++){
                      var finalStatus = app[i].finalStatus;
                      if (finalStatus == 'SUCCEEDED'){
                        //console.log(app[i]);
                        var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                        $('#yarn_table tbody').append(str);
                      }
                  }
                }
            });
            show_work();
            task_count();
            cluster_info();
        });
        //任务类型判断
        function show_task(Obj){
           var task_type = $(Obj).text();
           $.ajax({
                type:"GET",
                url:"/yarnInfo",
                dataType:"json",
                success:function(data){
                  var myobj=eval(data);
                  var app=myobj.apps.app;
                  if(task_type == '已完成的任务'){
                    $('#yarn_table tbody').html('');
                    for(var i=0;i<app.length;i++){
                      var finalStatus = app[i].finalStatus;
                      if (finalStatus == 'SUCCEEDED'){
                        var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                        $('#yarn_table tbody').append(str);
                      }
                    }
                  }
                  if(task_type == '运行中的任务'){
                    $('#yarn_table tbody').html('');
                    for(var i=0;i<app.length;i++){
                      var state = app[i].state;
                      if (state == 'RUNNING'){
                        var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                        $('#yarn_table tbody').append(str);
                      }
                    }
                  }
                  if(task_type == '已失败任务'){
                    $('#yarn_table tbody').html('');
                    for(var i=0;i<app.length;i++){
                      var finalStatus = app[i].finalStatus;
                      if (finalStatus == 'FAILED'){
                        var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                        $('#yarn_table tbody').append(str);
                      }
                    }
                  }
                }
            });
        };
        //work list准实时展示
        function show_work(){
           $('#work_table tbody').html("");
           $.ajax({
                type:"GET",
                url:"/workerlist",
                dataType:"json",
                success:function(data){
                  var myobj=eval(data);
                  var url = myobj.url;
                  var status = myobj.status;
                  var workers=myobj.workers;
                  for(var i=0;i<workers.length;i++){
                    var str = "<tr class='info'><td>"+workers[i].id+"</a></td><td>"+workers[i].host+"</td><td>"+workers[i].cores+"</td><td>"+workers[i].coresused+"</td><td>"+workers[i].memory+"</td><td>"+workers[i].memoryused+"</td><td>"+workers[i].state+"</td><td>"+new Date(workers[i].lastheartbeat).toLocaleString()+"</td><tr>"
                    $('#work_table tbody').append(str);
                  }
                }
            });
        }
        //setInterval(show_work,5000);
        //计算任务个数
        function task_count(){
            $.ajax({
                type:"GET",
                url:"/yarnInfo",
                dataType:"json",
                success:function(data){
                  var myobj=eval(data);
                  var app=myobj.apps.app;
                  var succ_task = 0;
                  var run_task = 0;
                  var fail_task = 0;
		 var plain_task =0;
                  for(var i=0;i<app.length;i++){
                      var finalStatus = app[i].finalStatus;
                      var state = app[i].state
			 //计算完成的
                      if(finalStatus == 'SUCCEEDED'){
                          succ_task += 1;
                      }
                      if(state == 'RUNNING'){
                          run_task += 1;
                      }
                      if(finalStatus == 'FAILED'){
                          fail_task += 1;
                      }
		      if(state == 'ACCEPTED'){
                          plain_task += 1;
                      }
                  }
                  $('#run').html(run_task);
                  $('#succ').html(succ_task);
                  $('#fail').html(fail_task);
                  $('#plain').html(plain_task);
                   }
            });

        }
    </script>
    <script>

         //spark集群运行情况
         function cluster_info(){
              $.ajax({
                type:"GET",
                url:"/spark_info",
                dataType:"json",
                 success:function(data){
                  var sparkinfo = eval(data);
                    var alive_worker = sparkinfo.alive_workers;
                    var alive_workers = alive_worker +" "+"Workers"
                    var cores = sparkinfo.cores;
                    var memory = sparkinfo.memory;
                    var applications = sparkinfo.applications;
                    var drivers = sparkinfo.drivers;
                    var status = sparkinfo.status;

                  $('#alive_workers').html(alive_workers);
                  $('#cores').html(cores);
                  $('#memory').html(memory);
                  $('#applications').html(applications);
                  $('#drivers').html(drivers);
                  $('#status').html(status);


                }
              });

         }


    </script>

}


