@(rpcInfo: RPCInfo,
dfsInfo:DFSInfo,
memInfo: MEMInfo,
time:String
)


@sidebar = {
<div class="sidebar-menu toggle-others collapsed">
    <div class="sidebar-menu-inner">
        <header class="logo-env">
            <!-- logo -->
            <div class="logo">
                <a href="@routes.Application.index" class="logo-expanded">
                    <img src="@routes.Assets.at("images/neptune.png")" width="90" alt="" />
                </a>
                <a href="@routes.Application.index" class="logo-collapsed">
                    <img src="@routes.Assets.at("images/favicon.png")" width="40" alt="" />
                </a>
            </div>
            <!-- This will toggle the mobile menu and will be visible only on mobile devices -->
            <div class="mobile-menu-toggle visible-xs">
                <a href="#" data-toggle="user-info-menu">
                    <i class="fa-bell-o"></i>
                    <span class="badge badge-success">7</span>
                </a>
                <a href="#" data-toggle="mobile-menu">
                    <i class="fa-bars"></i>
                </a>
            </div>

            <!-- This will open the popup with user profile settings, you can use for any purpose, just be creative -->
            <div class="settings-icon">
                <a href="#" data-toggle="settings-pane" data-animate="true">
                    <i class="fa fa-cog fa-4x"></i>
                </a>
            </div>

        </header>


        <ul id="main-menu" class="main-menu">
            <!-- add class "multiple-expanded" to allow multiple submenus to open -->
            <!-- class "auto-inherit-active-class" will automatically add "active" class for parent elements who are marked already with class "active" -->
            <li class="active">
                <a href="@routes.Application.index">
                    <i class="fa fa-dashboard fa-fw"></i>
                    <span class="title">仪表盘</span>
                </a>
            </li>
                    <li>
                        <a href="@routes.SparkJar.executejarpage">
                            <i class="fa fa-graduation-cap"></i>
                            <span class="title">SPARK-JAR应用</span>
                        </a>
                    </li>

            <li>
                <a href="#">
                    <i class="fa fa-table"></i>
                    <span class="title">APP数据</span>
                </a>
                <ul>
                    <li>
                        <a href="@routes.YarnList.yarnlist">
                            <span class="title">Yarn数据列表</span>
                        </a>
                    </li>
                    <li>
                        <a href="@routes.YarnList.sparklist">
                            <span class="title">Spark数据列表</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>

    </div>

</div>
}

@main("Neptun Dashboard")(sidebar) {

<link rel="stylesheet" href="@routes.Assets.at("stylesheets/sweetalert.css")" type="text/css"/>
<link rel="stylesheet" href="@routes.Assets.at("stylesheets/google.css")" type="text/css"/>

<script src="@routes.Assets.at("javascripts/globalize.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/dx.chartjs.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/sweetalert.min.js")" type="text/javascript"></script>
    <script charset="utf-8">
            $(document).ready(function(){
                $.ajax({
                    type:"GET",
                    url:"/yarnInfo",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var app=myobj.apps.app;
                        for(var i=0;i<app.length;i++){
                            var finalStatus = app[i].finalStatus;
                            if (finalStatus == 'SUCCEEDED'){
                                //console.log(app[i]);
                                var str = "<tr class='active'><td><a href='http://h136159.mars.grid.sina.com.cn:8088/proxy/"+app[i].id+"' target='_blank'>"+app[i].id+"</a></td><td>"+app[i].user+"</td><td>"+app[i].queue+"</td><td>"+app[i].finalStatus+"</td><td>"+app[i].progress+"</td><td>"+new Date(app[i].startedTime).toLocaleString()+"</td><td>"+new Date(app[i].finishedTime).toLocaleString()+"</td><tr>"
                                $('#yarn_table tbody').append(str);
                            }
                        }
                    }
                });
                show_work();
                getUserInfo();
                task_count();
                cluster_info();
            });
            //work list准实时展示
            function show_work(){
                $('#work_table tbody').html("");
                $.ajax({
                    type:"GET",
                    url:"/workerlist",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var url = myobj.url;
                        var status = myobj.status;
                        var workers=myobj.workers;
                        for(var i=0;i<workers.length;i++){
                            var str = "<tr class='info'><td>"+workers[i].id+"</a></td><td>"+workers[i].host+"</td><td>"+workers[i].cores+"</td><td>"+workers[i].coresused+"</td><td>"+workers[i].memory+"</td><td>"+workers[i].memoryused+"</td><td>"+workers[i].state+"</td><td>"+new Date(workers[i].lastheartbeat).toLocaleString()+"</td><tr>"
                            $('#work_table tbody').append(str);
                        }
                    }
                });
            }
            //setInterval(show_work,5000);
            //计算任务个数

            //获取用户权限
            function getUserInfo(){
                var retVal = '';
                $.ajax({
                    type:"GET",
                    url:"/whoiam",
                    dataType:"json",
                    async:false,
                    success:function(data){
                        retVal=data;
                    }
                });
                return retVal;
            }

            function task_count(){
                var data = getUserInfo();
                var userInfo = eval(data);
                var queueName = userInfo.queueName;
                $.ajax({
                    type:"GET",
                    url:"/yarnInfo",
                    dataType:"json",
                    success:function(data){
                        var myobj=eval(data);
                        var app=myobj.apps.app;
                        var succ_task = 0;
                        var run_task = 0;
                        var fail_task = 0;
                        var plain_task =0;
                        if(queueName == ""){
                            for(var i=0;i<app.length;i++){
                                var finalStatus = app[i].finalStatus;
                                var state = app[i].state
                                //计算完成的
                                if(finalStatus == 'SUCCEEDED'){
                                    succ_task += 1;
                                }
                                if(state == 'RUNNING'){
                                    run_task += 1;
                                }
                                if(finalStatus == 'FAILED'){
                                    fail_task += 1;
                                }
                                if(state == 'ACCEPTED'){
                                    plain_task += 1;
                                }
                            }
                        }
                        if(queueName != ""){
                            for(var i=0;i<app.length;i++){
                                var finalStatus = app[i].finalStatus;
                                var queue = app[i].queue;
                                var state = app[i].state;
                                //计算完成的
                                if(finalStatus == 'SUCCEEDED' && queue == queueName){
                                    succ_task += 1;
                                }
                                if(state == 'RUNNING' && queue == queueName){
                                    run_task += 1;
                                }
                                if(finalStatus == 'FAILED' && queue == queueName){
                                    fail_task += 1;
                                }
                                if(state == 'ACCEPTED' && finalStatus.queue == queueName){
                                    plain_task += 1;
                                }
                            }
                        }


                        $('#run').html(run_task);
                        $('#succ').html(succ_task);
                        $('#fail').html(fail_task);
                        $('#plain').html(plain_task);
                    }
                });

            }

    </script>


<script>
            //spark集群运行情况
            function cluster_info(){
                $.ajax({
                    type:"GET",
                    url:"/spark_info",
                    dataType:"json",
                    success:function(data){
                        var sparkinfo = eval(data);
                        var alive_worker = sparkinfo.alive_workers;
                        var alive_workers = alive_worker +" "+"Workers"
                        var cores = sparkinfo.cores;
                        var memory = sparkinfo.memory;
                        //var applications = sparkinfo.applications;
                        var drivers = sparkinfo.drivers;
                        //var status = sparkinfo.status;

                        var total_c = cores.split(",")[0];
                        var used_c = cores.split(",")[1].replace(" Used","");

                        var total_m = memory.split(",")[0];
                        var used_m = memory.split(",")[1].replace(" GB Used","");

                        var driver_run = drivers.split(",")[0].replace(" Running","");
                        var driver_all = drivers.split(",")[1];

                        $('#alive_workers').html(alive_workers.replace(" Workers",""));

                        $('#total_c').html(total_c);
                        $('#used_c').html(used_c);

                        $('#total_m').html(total_m);
                        $('#used_m').html(used_m);

                        //$('#applications').html(applications);

                        $('#driver_run').html(driver_run);
                        $('#driver_all').html(driver_all);

                        //$('#status').html(status);

                    }
                });

            }


    </script>




<div class="row">

    <div class="col-sm-3">

        <div class="xe-widget xe-counter">
            <div class="xe-icon">
                <i class="fa fa-train fa-2x"></i>
            </div>
            <div class="xe-label">
                <strong class="num" id="run">0</strong>
                <span>运行中</span>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter xe-counter-blue">
            <div class="xe-icon">
                <i class="fa fa-check fa-2x"></i>
            </div>
            <div class="xe-label">
                <strong class="num" id="succ">0</strong>
                <span>成功执行</span>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter xe-counter-info">
            <div class="xe-icon">
                <i class="fa-times fa-2x"></i>
            </div>
            <div class="xe-label">
                <strong class="num" id="fail">0</strong>
                <span>失败</span>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter xe-counter-red">
            <div class="xe-icon">
                <i class="fa fa-plane fa-2x"></i>
            </div>
            <div class="xe-label">
                <strong class="num" id="plain">0</strong>
                <span>计划任务</span>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter-block" >
            <div class="xe-upper">

                <div class="xe-icon">
                    <i class="fa fa-heartbeat fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="alive_workers"></strong>
                    <span>Alive Worker</span>
                </div>

            </div>
            <div class="xe-lower">
                <div class="border"></div>
                <span>Total Nodes</span>
                <strong >0</strong>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter-block xe-counter-block-purple" >
            <div class="xe-upper">

                <div class="xe-icon">
                    <i class="fa fa-puzzle-piece fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="used_c">0</strong>
                    <span>Used Cores</span>
                </div>

            </div>
            <div class="xe-lower">
                <div class="border"></div>
                <span>Total Cores</span>
                <strong id="total_c">0</strong>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter-block xe-counter-block-red" >
            <div class="xe-upper">

                <div class="xe-icon">
                    <i class="fa fa-building fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="used_m">0</strong>
                    <span>Spark Mem</span>
                </div>

            </div>
            <div class="xe-lower">
                <div class="border"></div>
                <span>Total Mem</span>
                <strong id="total_m">0</strong>
            </div>
        </div>

    </div>

    <div class="col-sm-3">

        <div class="xe-widget xe-counter-block xe-counter-block-pink" >
            <div class="xe-upper">

                <div class="xe-icon">
                    <i class="fa fa-info fa-2x"></i>
                </div>
                <div class="xe-label">
                    <strong class="num" id="driver_run">0</strong>
                    <span>Drivers Info</span>
                </div>

            </div>
            <div class="xe-lower">
                <div class="border"></div>
                <span>Total Mem</span>
                <strong id="driver_all">0</strong>
            </div>
        </div>

    </div>

    <div class="clearfix"></div>


    <div class="panel panel-body">

        <div class="row">


            <div class="col-sm-20">
                <div style="height: 440px ; margin: 0;">

                    <div id="container1" style="margin:12px;
                        display:-moz-inline-box;
                        display:inline-block;
                        width:31%;  height:350px;"
                                        ></div>

                    <div id="container2" style="margin:12px;
                    display:-moz-inline-box;
                    display:inline-block;
                    width:31%;  height:350px;"></div>

                    <div id="container3" style="margin:12px;
                        display:-moz-inline-box;
                        display:inline-block;
                        width:31%;  height:350px;"></div>


                </div>
            </div>

        </div>
    </div>




</div>

<script>

            <!--yarn资源计算   -->
            function group_resource(){
                var retVal = '';
                $.ajax({
                    type:"GET",
                    url:"/userResource",
                    dataType:"json",
                    async:false,
                    success:function(data){
                        retVal=data;
                    }
                });
                return retVal;
            }
            var data = group_resource();
            var rate = eval(data);
            var rateData = rate.rateData.resourceRate;
            memory_count();
            <!--已使用内存统计-->
            function memory_count(){
                var data = group_resource();
                var rate = eval(data);
                var rateMemory = rate.rateData.rateMemory;
                $("#userdRateMemory").attr("data-to", rateMemory);
                <!--$("#userdRateMemory").prop("data-to", rateMemory);-->
            };
            <!--setInterval('memory_count()',5000);-->
            setInterval(memory_count,5000);

    </script>

    <script>
                $(document).ready(function(){
                    $.ajax({
                        type:"GET",
                        url:"/whoiam",
                        dataType:"json",
                        success:function(data){
                            var myobj=eval(data);
                            var trackingSum=myobj.trackingSum;
                            $('#tracking').html(trackingSum);
                        }
                    });
                });
     </script>


@* <script>
    $(document).ready(function () {
    var data=[
    {role:"Spark",
    nums:6
    },
    {role:"Hadoop",
    nums:5
    },
    {role:"Hbase",
    nums:3
    },
    {role:"Hive",
    nums:1
    },
    {roles:"Mysql",
    num:1
    }
    ];

    $("#chart_container").dxPieChart({
    dataSource: data,
    series: [
    {
    argumentField: "role",
    valueField: "nums",
    label: {
    visible: true,
    connector: {
    visible: true,
    width: 1,
    verticalAlignment:"bottom"
    },
    }
    }
    ],
    title: "Area of Countries",
    onPointClick: function (e) {
    var point = e.target;

    toggleVisibility(point);
    },
    onLegendClick: function (e) {
    var arg = e.target;

    toggleVisibility(this.getAllSeries()[0].getPointsByArg(arg)[0]);
    }
    });

    function toggleVisibility(item) {
    item.isVisible() ? item.hide() : item.show();
    }

    });
    </script>*@


<script>
$(function () {
    $('#container1').highcharts({
        global:{
                useUTC:false
            },
            credits:{
                enabled:false
            },
        chart: {
            type: 'area'
        },
        title: {
            text: 'HDFS Summary'
        },
        subtitle: {
            text: 'data capacity used  summary'
        },
        xAxis: {
                 type: 'datetime',
                   dateTimeLabelFormats: {
                   //hour: '%H:%M'
                   day: '%H:%M'
                }
        },
        yAxis: {
            title: {
                text: 'use percent(%)'
            },
            min: 0,
            minorGridLineWidth: 1,
            gridLineWidth: 1,
            alternateGridColor: null
        },
        tooltip: {
            pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.percentage:.1f}%</b> ({point.y:,.0f} GB)<br/>',
            shared: true,
            valueSuffix: 'GB'
        },
        plotOptions: {
            area: {
                stacking: 'percent',
                lineColor: '#ffffff',
                lineWidth: 1,
                marker: {
                    enabled: false
                },
                pointInterval: 360000, // one hour
                pointStart: Date.UTC(@time) //年月日时分秒
            }
        },
        series: [{
            name: 'CapacityUsed (GB)',
            data: @dfsInfo.capacityUsed
        }, {
            name: 'CapacityRemaining (GB)',
            data: @dfsInfo.capacityRemaining
        }, {
            name: 'CapacityUsedNonDFS (GB)',
            data: @dfsInfo.capacityUsedNonDFS
        }]
    });
});


</script>

<script>
    $(function () {
    $('#container2').highcharts({
        global:{
                useUTC:false
            },
        chart: {
            type: 'spline'
        },
        credits:{
                enabled:false
            },
        title: {
            text: 'hadoop RPC'
        },
        subtitle: {
            text: 'number of bytes rpc read and send'
        },
        xAxis: {
            type: 'datetime',
                   dateTimeLabelFormats: {
                   //hour: '%H:%M'
                   day: '%H:%M'
                }
        },
        yAxis: {
            title: {
                text: 'rpc speed (KB)'
            }
        },
        tooltip: {
            valueSuffix: 'kb'
        },
        plotOptions: {
            spline: {
                lineWidth: 2,
                states: {
                    hover: {
                        lineWidth: 4
                    }
                },
                marker: {
                    enabled: false
                },
                pointInterval: 360000, // one hour
                pointStart: Date.UTC(@time) //年月日时分秒
                //pointEnd:Date.UTC(2017,2,20, 6, 0, 0)
            }
        },
        series: [{
            name: 'received (kb)',
            data: @rpcInfo.rec_rpc //length=16
        }, {
            name: 'sent (kb)',
            data: @rpcInfo.sent_rpc

        }],
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
});

</script>

<script>
    $(function () {
    $('#container3').highcharts({
        global:{
                useUTC:false
            },
        chart: {
            type: 'spline'
        },
        credits:{
                enabled:false
            },
        title: {
            text: 'hadoop mem use'
        },
        subtitle: {
            text: 'number of mb MemNonHeapUsedM and MemHeapUsedM'
        },
        xAxis: {
            type: 'datetime',
                   dateTimeLabelFormats: {
                   //hour: '%H:%M'
                   day: '%H:%M'
                }
        },
        yAxis: {
            title: {
                text: 'mem use speed (MB)'
            }
        },
        tooltip: {
            valueSuffix: 'mb'
        },
        plotOptions: {
            spline: {
                lineWidth: 2,
                states: {
                    hover: {
                        lineWidth: 4
                    }
                },
                marker: {
                    enabled: false
                },
                pointInterval: 360000, // one hour
                pointStart: Date.UTC(@time) //年月日时分秒
            }
        },
        series: [{
            name: 'memNonHeapUsedM (MB)',
            data: @memInfo.memNonHeapUsedM //length=16
        }, {
            name: 'memHeapUsedM (MB)',
            data: @memInfo.memHeapUsedM

        }],
        navigation: {
            menuItemStyle: {
                fontSize: '10px'
            }
        }
    });
});
</script>



<div class="clearfix"></div>
@copyright()


}

